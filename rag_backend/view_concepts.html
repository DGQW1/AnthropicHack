<!DOCTYPE html>
<html>
<head>
    <title>Concept Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 4px 4px 0 0;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        #concepts {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .concept {
            background-color: #f0f0f0;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .concept:hover {
            background-color: #e0e0e0;
        }
        #content {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 4px;
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
        }
        .content-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .source {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        #loading {
            text-align: center;
            margin: 20px;
            display: none;
        }
        #file-form {
            margin-bottom: 20px;
        }
        #file-path {
            width: 70%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 8px 16px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3367d6;
        }
        #summary-result {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .key-concept {
            margin-top: 10px;
            font-weight: bold;
            color: #4285f4;
        }
    </style>
</head>
<body>
    <h1>Course Content Explorer</h1>
    
    <div class="tabs">
        <div class="tab active" data-tab="concepts-tab">Concepts</div>
        <div class="tab" data-tab="summarize-tab">Summarize File</div>
        <div class="tab" data-tab="direct-tab">Text Summarization</div>
    </div>
    
    <div id="loading">Loading...</div>
    
    <div id="concepts-tab" class="tab-content active">
        <h2>All Concepts</h2>
        <div id="concepts"></div>
        
        <h2>Content</h2>
        <div id="content">
            <p>Select a concept to view related content.</p>
        </div>
    </div>
    
    <div id="summarize-tab" class="tab-content">
        <h2>Summarize PDF File</h2>
        <p>Enter the path to a PDF file to generate a summary and extract its key concept.</p>
        
        <div id="file-form">
            <input type="text" id="file-path" placeholder="../270handout/file.pdf" />
            <button id="summarize-btn">Summarize</button>
        </div>
        
        <div id="summary-result" style="display: none;">
            <h3>Summary</h3>
            <p id="summary-text"></p>
            <div class="key-concept">
                <strong>Key Concept:</strong> <span id="key-concept"></span>
            </div>
        </div>
    </div>
    
    <div id="direct-tab" class="tab-content">
        <h2>Direct Text Summarization</h2>
        <p>Enter computer science text to extract key concepts and generate a summary.</p>
        
        <div id="text-form">
            <textarea id="input-text" rows="10" style="width: 100%; padding: 8px;" 
                placeholder="Paste computer science text here..."></textarea>
            <button id="extract-btn" style="margin-top: 10px;">Extract Concepts & Summarize</button>
        </div>
        
        <div id="extraction-result" style="display: none; margin-top: 20px;">
            <h3>Extracted Concepts</h3>
            <div id="extracted-concepts" style="margin-bottom: 20px;"></div>
            
            <h3>Text Summary</h3>
            <p id="text-summary"></p>
        </div>
    </div>
    
    <script>
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Deactivate all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                
                // Activate clicked tab
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });
        
        // Fetch all concepts
        fetch('http://localhost:8000/concepts')
            .then(response => response.json())
            .then(concepts => {
                const conceptsContainer = document.getElementById('concepts');
                concepts.forEach(concept => {
                    const conceptEl = document.createElement('div');
                    conceptEl.className = 'concept';
                    conceptEl.textContent = concept;
                    conceptEl.onclick = () => loadConceptContent(concept);
                    conceptsContainer.appendChild(conceptEl);
                });
            })
            .catch(error => {
                console.error('Error fetching concepts:', error);
                document.getElementById('concepts').innerHTML = 
                    '<p>Error loading concepts. Make sure the backend server is running.</p>';
            });
            
        function loadConceptContent(concept) {
            const contentEl = document.getElementById('content');
            const loadingEl = document.getElementById('loading');
            
            contentEl.innerHTML = '';
            loadingEl.style.display = 'block';
            
            fetch(`http://localhost:8000/concept/${encodeURIComponent(concept)}`)
                .then(response => response.json())
                .then(data => {
                    loadingEl.style.display = 'none';
                    
                    if (data.content.length === 0 && data.questions.length === 0) {
                        contentEl.innerHTML = '<p>No content found for this concept.</p>';
                        return;
                    }
                    
                    // Display content
                    const contentHeading = document.createElement('h3');
                    contentHeading.textContent = `Content for "${concept}"`;
                    contentEl.appendChild(contentHeading);
                    
                    data.content.forEach(item => {
                        const itemEl = document.createElement('div');
                        itemEl.className = 'content-item';
                        
                        const textEl = document.createElement('p');
                        textEl.textContent = item.text.substring(0, 500) + 
                            (item.text.length > 500 ? '...' : '');
                        itemEl.appendChild(textEl);
                        
                        const sourceEl = document.createElement('div');
                        sourceEl.className = 'source';
                        sourceEl.textContent = `Source: ${item.metadata.source} (${item.metadata.source_type})`;
                        itemEl.appendChild(sourceEl);
                        
                        contentEl.appendChild(itemEl);
                    });
                    
                    // Display questions if any
                    if (data.questions.length > 0) {
                        const questionsHeading = document.createElement('h3');
                        questionsHeading.textContent = 'Related Questions';
                        contentEl.appendChild(questionsHeading);
                        
                        data.questions.forEach(item => {
                            const itemEl = document.createElement('div');
                            itemEl.className = 'content-item';
                            
                            const textEl = document.createElement('p');
                            textEl.textContent = item.text.substring(0, 500) + 
                                (item.text.length > 500 ? '...' : '');
                            itemEl.appendChild(textEl);
                            
                            const sourceEl = document.createElement('div');
                            sourceEl.className = 'source';
                            sourceEl.textContent = `Source: ${item.source}`;
                            itemEl.appendChild(sourceEl);
                            
                            contentEl.appendChild(itemEl);
                        });
                    }
                })
                .catch(error => {
                    loadingEl.style.display = 'none';
                    console.error('Error fetching concept content:', error);
                    contentEl.innerHTML = 
                        `<p>Error loading content for "${concept}". Make sure the backend server is running.</p>`;
                });
        }
        
        // Summarize file
        document.getElementById('summarize-btn').addEventListener('click', () => {
            const filePath = document.getElementById('file-path').value.trim();
            if (!filePath) {
                alert('Please enter a file path');
                return;
            }
            
            const loadingEl = document.getElementById('loading');
            const resultEl = document.getElementById('summary-result');
            
            loadingEl.style.display = 'block';
            resultEl.style.display = 'none';
            
            fetch(`http://localhost:8000/summarize/${encodeURIComponent(filePath)}`)
                .then(response => response.json())
                .then(data => {
                    loadingEl.style.display = 'none';
                    
                    if (data.error) {
                        alert(`Error: ${data.error}`);
                        return;
                    }
                    
                    document.getElementById('summary-text').textContent = data.summary;
                    document.getElementById('key-concept').textContent = data.key_concept;
                    resultEl.style.display = 'block';
                })
                .catch(error => {
                    loadingEl.style.display = 'none';
                    console.error('Error summarizing file:', error);
                    alert('Error summarizing file. Make sure the backend server is running.');
                });
        });
        
        // Direct text summarization
        document.getElementById('extract-btn').addEventListener('click', () => {
            const text = document.getElementById('input-text').value.trim();
            if (!text) {
                alert('Please enter some text to analyze');
                return;
            }
            
            const loadingEl = document.getElementById('loading');
            const resultEl = document.getElementById('extraction-result');
            const conceptsEl = document.getElementById('extracted-concepts');
            
            loadingEl.style.display = 'block';
            resultEl.style.display = 'none';
            
            // First approach: Display frequency-based concept extraction
            // In a real implementation, we would call the API endpoint 
            // For this demo, we'll implement a simple version in JavaScript
            
            // Remove punctuation and convert to lowercase
            let processedText = text.toLowerCase();
            for (const char of ".,;:!?()[]{}\"''-â€”") {
                processedText = processedText.replaceAll(char, ' ');
            }
            
            // Get words and filter stop words
            const stopWords = new Set(['the', 'a', 'an', 'and', 'or', 'but', 'if', 'then', 'else', 'when', 
                'at', 'by', 'for', 'with', 'about', 'against', 'between', 'into', 
                'through', 'during', 'before', 'after', 'above', 'below', 'to', 'from', 
                'up', 'down', 'in', 'out', 'on', 'off', 'over', 'under', 'again', 
                'further', 'then', 'once', 'here', 'there', 'when', 'where', 'why', 
                'how', 'all', 'any', 'both', 'each', 'few', 'more', 'most', 'other', 
                'some', 'such', 'no', 'nor', 'not', 'only', 'own', 'same', 'so', 
                'than', 'too', 'very', 'can', 'will', 'just', 'should', 'now']);
            
            const words = processedText.split(/\s+/).filter(w => w.length > 3 && !stopWords.has(w));
            
            // Count word frequencies
            const wordCounts = {};
            for (const word of words) {
                wordCounts[word] = (wordCounts[word] || 0) + 1;
            }
            
            // Sort by frequency
            const sortedWords = Object.entries(wordCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10)
                .map(([word]) => word);
            
            // Build summary - extract first paragraph or first 200 chars if no paragraphs
            let summary = "";
            const paragraphs = text.split('\n\n');
            if (paragraphs.length > 0) {
                summary = paragraphs[0].length > 200 ? 
                    paragraphs[0].substring(0, 200) + "..." : 
                    paragraphs[0];
            } else {
                summary = text.length > 200 ? 
                    text.substring(0, 200) + "..." : 
                    text;
            }
            
            // Update the UI
            loadingEl.style.display = 'none';
            
            conceptsEl.innerHTML = '';
            sortedWords.forEach(concept => {
                const conceptEl = document.createElement('div');
                conceptEl.className = 'concept';
                conceptEl.textContent = concept;
                conceptsEl.appendChild(conceptEl);
            });
            
            document.getElementById('text-summary').textContent = summary;
            resultEl.style.display = 'block';
        });
    </script>
</body>
</html> 